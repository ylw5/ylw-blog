页面中的大部分任务都是在渲染进程的主线程上执行，这些任务包括了：

- 渲染事件（解析 DOM、计算布局、绘制）
- 用户交互事件（鼠标点击、滚动页面、页面缩放）
- JavaScript 脚本执行事件
- 网络请求完成、文件读写完成事件

为了协调这些任务在主线程上执行，引入消息队列和事件循环机制。主线程不断循环从任务队列中取出任务并执行。



异步回调





微任务的产生重要是解决了宏任务无法兼顾的实时性的问题，因为宏任务无法控制将任务加入消息队列的时间。

每个宏任务关联一个微任务队列（V8 在创建全局执行上下文时内部创建了一个微任务队列），按顺序存放当前宏任务执行过程中产生的多个微任务。

产生微任务方式：

- 使用 MutationObserver 监控某个 DOM 节点，然后通过 JavaScript 修改这个节点，当 DOM 节点发生变化时，就会产生 DOM 变化记录的微任务。
- 使用 Promise

当前宏任务中的 JavaScript 快执行完时（JavaScript 引擎准备退出全局执行上下文并清空调用栈时），引擎会检查全局上下文中的微任务队列，然后按顺序执行。

如果在执行微任务的过程中产生了新的微任务，同样会将该微任务添加到微任务队列中，V8 引擎一直循环执行队列中的任务知道队列清空。（一直在当前宏任务中）